# HÆ°á»›ng dáº«n TÃ­nh nÄƒng Cáº¥p Chá»©ng nháº­n

## Tá»•ng quan

TÃ­nh nÄƒng cáº¥p chá»©ng nháº­n cho phÃ©p ngÆ°á»i tham gia cuá»™c thi táº£i vá» chá»©ng nháº­n hoÃ n thÃ nh sau khi Ä‘áº¡t Ä‘iá»ƒm yÃªu cáº§u (â‰¥ 60%).

## YÃªu cáº§u nháº­n chá»©ng nháº­n

- **Äiá»ƒm tá»‘i thiá»ƒu**: 60% (6/10 cÃ¢u Ä‘Ãºng)
- **HoÃ n thÃ nh bÃ i thi**: Pháº£i ná»™p bÃ i vÃ  cÃ³ káº¿t quáº£
- **ThÃ nh tÃ­ch xuáº¥t sáº¯c**: â‰¥ 80% sáº½ cÃ³ huy hiá»‡u Ä‘áº·c biá»‡t

## Ná»™i dung Chá»©ng nháº­n

Chá»©ng nháº­n bao gá»“m cÃ¡c thÃ´ng tin sau:

1. **ThÃ´ng tin cÃ¡ nhÃ¢n**
   - Há» vÃ  tÃªn ngÆ°á»i tham gia
   - ÄÆ¡n vá»‹
   - Khoa/PhÃ²ng

2. **ThÃ´ng tin cuá»™c thi**
   - TÃªn cuá»™c thi
   - Äiá»ƒm sá»‘: X/Y Ä‘iá»ƒm (Z%)
   - Thá»i gian hoÃ n thÃ nh: MM:SS

3. **ThÃ´ng tin xÃ¡c thá»±c**
   - NgÃ y cáº¥p (ngÃ y hoÃ n thÃ nh bÃ i thi)
   - Ban GiÃ¡m Äá»‘c (Ä‘Ã£ kÃ½)

4. **Huy hiá»‡u thÃ nh tÃ­ch** (náº¿u Ä‘áº¡t â‰¥ 80%)
   - âœ¨ THÃ€NH TÃCH XUáº¤T Sáº®C âœ¨

## CÃ¡ch sá»­ dá»¥ng

### 1. HoÃ n thÃ nh bÃ i thi

NgÆ°á»i tham gia cáº§n:
- ÄÄƒng kÃ½ tham gia cuá»™c thi
- HoÃ n thÃ nh táº¥t cáº£ cÃ¢u há»i
- Ná»™p bÃ i thi

### 2. Xem káº¿t quáº£

Sau khi ná»™p bÃ i, há»‡ thá»‘ng sáº½ hiá»ƒn thá»‹:
- Äiá»ƒm sá»‘ vÃ  pháº§n trÄƒm chÃ­nh xÃ¡c
- Thá»i gian hoÃ n thÃ nh
- Sá»‘ cÃ¢u Ä‘Ãºng/sai

### 3. Táº£i chá»©ng nháº­n

Náº¿u Ä‘áº¡t â‰¥ 60%:
- NÃºt **"ğŸ“ Táº£i chá»©ng nháº­n"** sáº½ xuáº¥t hiá»‡n
- Click vÃ o nÃºt Ä‘á»ƒ má»Ÿ cá»­a sá»• chá»©ng nháº­n
- Chá»n má»™t trong cÃ¡c tÃ¹y chá»n:
  - **In ngay**: Sá»­ dá»¥ng nÃºt "ğŸ–¨ï¸ In chá»©ng nháº­n"
  - **LÆ°u PDF**: Print â†’ chá»n "Save as PDF"
  - **ÄÃ³ng**: NÃºt "âœ–ï¸ ÄÃ³ng" Ä‘á»ƒ quay láº¡i

### 4. In hoáº·c lÆ°u PDF

**CÃ¡ch lÆ°u thÃ nh PDF:**
1. Click "ğŸ–¨ï¸ In chá»©ng nháº­n"
2. Trong há»™p thoáº¡i in:
   - Windows: Ctrl + P â†’ chá»n "Microsoft Print to PDF"
   - Mac: Cmd + P â†’ chá»n "Save as PDF"
   - Chrome: chá»n "Save as PDF" trong Destination
3. Chá»n vá»‹ trÃ­ lÆ°u file
4. Click "Save"

**Máº¹o in Ä‘áº¹p:**
- Orientation: Landscape (ngang)
- Paper size: A4
- Margins: Default
- Scale: 100%

## Thiáº¿t káº¿ Chá»©ng nháº­n

### Giao diá»‡n

- **Khung viá»n**: VÃ ng kim cao cáº¥p (double border)
- **MÃ u chá»§ Ä‘áº¡o**: Gradient tÃ­m-xanh (#667eea â†’ #764ba2)
- **Typography**: Font Segoe UI, kÃ­ch thÆ°á»›c tá»‘i Æ°u cho 1 trang
- **Icon**: Trophy emoji ğŸ†, thÃ nh tÃ­ch â­
- **Layout**: CÄƒn giá»¯a, cÃ¢n Ä‘á»‘i, **vá»«a Ä‘Ãºng 1 trang A4 landscape**

### KÃ­ch thÆ°á»›c Tá»‘i Æ°u (Single Page)

- **Paper Size**: A4 Landscape (297mm x 210mm)
- **Border**: 10px vÃ ng kim (giáº£m tá»« 12px)
- **Padding**: 30px 50px (giáº£m tá»« 60px 80px)
- **Font Sizes** (Ä‘Ã£ tá»‘i Æ°u):
  - Title: 48px (giáº£m tá»« 64px)
  - Name: 38px (giáº£m tá»« 56px)
  - Contest: 24px (giáº£m tá»« 32px)
  - Details: 16px (giáº£m tá»« 20px)
- **Spacing**: Margins vÃ  gaps Ä‘Ã£ giáº£m thiá»ƒu
- **Print Settings**: @page vá»›i size A4 landscape + page-break controls

### Responsive

- Desktop: Full size (1000px max-width)
- Mobile: Tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh (grid 1 column)
- Print: **CHá»ˆ 1 TRANG A4 landscape duy nháº¥t**

## Cáº¥u trÃºc Code

### 1. Component Certificate

**File**: `components/contest/CertificateTemplate.tsx`
- Component React hiá»ƒn thá»‹ chá»©ng nháº­n
- Props: CertificateData
- CÃ³ thá»ƒ dÃ¹ng cho preview hoáº·c print

### 2. API Endpoint

**File**: `app/api/contest/certificate/route.ts`
- Endpoint: `POST /api/contest/certificate`
- Body: `{ submission_id: string }`
- Response: HTML chá»©ng nháº­n hoÃ n chá»‰nh

**Logic:**
1. Validate submission_id
2. Fetch submission + participant + contest data
3. Kiá»ƒm tra Ä‘iá»ƒm â‰¥ 60%
4. Format dá»¯ liá»‡u
5. Generate HTML template
6. Return HTML response

### 3. Type Definitions

**File**: `types/contest.ts`

```typescript
export interface CertificateData {
  fullName: string;
  department: string;
  unit: string;
  contestTitle: string;
  score: number;
  totalQuestions: number;
  percentage: number;
  completionTime: string;
  completionDate: string;
}
```

### 4. Result Page Integration

**File**: `app/contest/result/page.tsx`

**ThÃªm function:**
```typescript
const handleDownloadCertificate = async () => {
  // Gá»i API /api/contest/certificate
  // Má»Ÿ window má»›i vá»›i HTML response
}
```

**ThÃªm UI:**
```tsx
{percentage >= 60 && (
  <button onClick={handleDownloadCertificate}>
    ğŸ“ Táº£i chá»©ng nháº­n
  </button>
)}
```

## API Usage

### Request

```javascript
POST /api/contest/certificate
Content-Type: application/json

{
  "submission_id": "uuid-submission-id"
}
```

### Success Response (200)

```html
<!DOCTYPE html>
<html>
  <!-- Full certificate HTML -->
</html>
```

### Error Responses

**400 - Thiáº¿u submission_id**
```json
{
  "success": false,
  "error": "Thiáº¿u submission_id"
}
```

**400 - Äiá»ƒm chÆ°a Ä‘áº¡t**
```json
{
  "success": false,
  "error": "Äiá»ƒm chÆ°a Ä‘áº¡t yÃªu cáº§u Ä‘á»ƒ nháº­n chá»©ng nháº­n (tá»‘i thiá»ƒu 60%)"
}
```

**404 - KhÃ´ng tÃ¬m tháº¥y**
```json
{
  "success": false,
  "error": "KhÃ´ng tÃ¬m tháº¥y bÃ i thi"
}
```

## Customization

### Thay Ä‘á»•i thiáº¿t káº¿

Chá»‰nh sá»­a function `generateCertificateHTML()` trong:
`app/api/contest/certificate/route.ts`

**MÃ u sáº¯c:**
- Border vÃ ng: `#FFD700`, `#FFC107`
- Gradient chÃ­nh: `#667eea`, `#764ba2`
- Achievement badge: `#FFD700`, `#FFA500`

**Layout:**
- Container: `.certificate-container`
- Header: `.header`
- Body: `.body`
- Footer: `.footer`

### Thay Ä‘á»•i Ä‘iá»u kiá»‡n

**Äiá»ƒm tá»‘i thiá»ƒu:**

Trong `route.ts`:
```typescript
if (percentage < 60) { // Äá»•i 60 thÃ nh Ä‘iá»ƒm khÃ¡c
  return NextResponse.json({
    error: 'Äiá»ƒm chÆ°a Ä‘áº¡t...'
  })
}
```

Trong `page.tsx`:
```tsx
{percentage >= 60 && ( // Äá»•i 60 tÆ°Æ¡ng á»©ng
  <button>Táº£i chá»©ng nháº­n</button>
)}
```

**Äiá»u kiá»‡n xuáº¥t sáº¯c:**

```typescript
const achievementBadge = percentage >= 80 // Äá»•i 80
```

### ThÃªm logo/hÃ¬nh áº£nh

Trong HTML template:

```html
<div class="header">
  <img src="/Logo.jpg" alt="Logo" style="width: 100px;" />
  <!-- rest of header -->
</div>
```

### ThÃªm chá»¯ kÃ½ sá»‘

```html
<div class="footer-item">
  <div class="footer-label">Ban GiÃ¡m Äá»‘c</div>
  <img src="/signature.png" alt="Signature" style="width: 150px;" />
  <div class="footer-value">Nguyá»…n VÄƒn A</div>
</div>
```

## Troubleshooting

### KhÃ´ng tháº¥y nÃºt "Táº£i chá»©ng nháº­n"

**NguyÃªn nhÃ¢n:**
- Äiá»ƒm < 60%
- ChÆ°a hoÃ n thÃ nh bÃ i thi

**Giáº£i phÃ¡p:**
- Kiá»ƒm tra `percentage >= 60`
- Kiá»ƒm tra `resultData.submission.status === 'completed'`

### Popup bá»‹ cháº·n

**NguyÃªn nhÃ¢n:**
- Browser block popup

**Giáº£i phÃ¡p:**
- Cho phÃ©p popup tá»« localhost/domain
- DÃ¹ng download link thay vÃ¬ window.open

### PDF khÃ´ng Ä‘áº¹p khi in

**Giáº£i phÃ¡p:**
- Chá»n Landscape orientation
- Scale 100%
- Uncheck headers/footers
- Chá»n paper size = A4

### Thiáº¿u dá»¯ liá»‡u

**NguyÃªn nhÃ¢n:**
- Department/Unit null trong database

**Giáº£i phÃ¡p:**
- ThÃªm fallback: `|| 'ChÆ°a xÃ¡c Ä‘á»‹nh'`
- Validate dá»¯ liá»‡u khi Ä‘Äƒng kÃ½

## Best Practices

### 1. Security

- âœ… Validate submission_id
- âœ… Check submission ownership (náº¿u cáº§n auth)
- âœ… Sanitize user input (prevent XSS)

### 2. Performance

- âœ… DÃ¹ng sessionStorage cho result data
- âœ… Cache API response náº¿u cÃ³ thá»ƒ
- âœ… Optimize HTML size

### 3. UX

- âœ… Clear messaging (Ä‘áº¡t/chÆ°a Ä‘áº¡t)
- âœ… Loading states
- âœ… Error handling vá»›i user-friendly messages
- âœ… Print instructions

### 4. Accessibility

- âœ… Semantic HTML
- âœ… Proper heading hierarchy
- âœ… Alt text cho images
- âœ… Good contrast ratios

## Future Enhancements

### Planned Features

1. **QR Code verification**
   - ThÃªm QR code vÃ o chá»©ng nháº­n
   - Scan Ä‘á»ƒ verify tÃ­nh há»£p lá»‡

2. **Email delivery**
   - Gá»­i PDF qua email tá»± Ä‘á»™ng
   - Template email Ä‘áº¹p

3. **Certificate gallery**
   - LÆ°u lá»‹ch sá»­ chá»©ng nháº­n
   - Xem láº¡i cÃ¡c chá»©ng nháº­n Ä‘Ã£ nháº­n

4. **Social sharing**
   - Share image cá»§a certificate
   - LinkedIn integration

5. **Multilingual**
   - English certificate option
   - Internationalization support

6. **Custom templates**
   - Admin cÃ³ thá»ƒ customize template
   - Multiple certificate designs

## Support

Náº¿u cÃ³ váº¥n Ä‘á» hoáº·c cÃ¢u há»i:
1. Kiá»ƒm tra console logs
2. Xem network requests
3. LiÃªn há»‡ dev team

---

**Version**: 1.0  
**Last Updated**: October 2025  
**Author**: CODEX ADR Team

