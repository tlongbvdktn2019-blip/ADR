# HÆ°á»›ng Dáº«n QuÃ©t QR Tháº» Dá»‹ á»¨ng Báº±ng Zalo

## ğŸ¯ TÃ­nh NÄƒng Má»›i

BÃ¢y giá» báº¡n cÃ³ thá»ƒ quÃ©t mÃ£ QR trÃªn tháº» dá»‹ á»©ng báº±ng **báº¥t ká»³ á»©ng dá»¥ng nÃ o**:
- âœ… **Zalo** (QuÃ©t QR trong Zalo)
- âœ… **Camera Ä‘iá»‡n thoáº¡i** (iPhone, Android)
- âœ… **Báº¥t ká»³ app quÃ©t QR nÃ o** (QR Scanner, etc.)
- âœ… **App ná»™i bá»™** (Váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng)
- âœ… **Import áº£nh QR** (Táº£i áº£nh QR cÃ³ sáºµn tá»« mÃ¡y - Má»šI!) ğŸ†•

## ğŸ”„ Nhá»¯ng GÃ¬ ÄÃ£ Thay Äá»•i

### TrÆ°á»›c ÄÃ¢y
```
QR Code chá»©a: {"cardCode":"AC-2024-123456","patientName":"Nguyá»…n VÄƒn A",...}
âŒ Chá»‰ app ná»™i bá»™ Ä‘á»c Ä‘Æ°á»£c
âŒ Zalo/Camera hiá»ƒn thá»‹ JSON khÃ³ Ä‘á»c
```

### BÃ¢y Giá»
```
QR Code chá»©a: https://yourdomain.com/allergy-cards/view/AC-2024-123456
âœ… Má»i app QR Ä‘á»u má»Ÿ Ä‘Æ°á»£c
âœ… Hiá»ƒn thá»‹ giao diá»‡n Ä‘áº¹p, Ä‘áº§y Ä‘á»§ thÃ´ng tin
âœ… KhÃ´ng cáº§n Ä‘Äƒng nháº­p
âœ… Truy cáº­p cÃ´ng khai an toÃ n
```

## ğŸ“± CÃ¡ch Sá»­ Dá»¥ng

### 1. QuÃ©t Báº±ng Zalo

1. Má»Ÿ **Zalo**
2. Chá»n icon **QuÃ©t QR** (gÃ³c trÃªn bÃªn pháº£i)
3. HÆ°á»›ng camera vÃ o mÃ£ QR trÃªn tháº» dá»‹ á»©ng
4. Zalo sáº½ tá»± Ä‘á»™ng má»Ÿ link vÃ  hiá»ƒn thá»‹ thÃ´ng tin tháº»

### 2. QuÃ©t Báº±ng Camera iPhone

1. Má»Ÿ app **Camera**
2. HÆ°á»›ng camera vÃ o mÃ£ QR
3. Nháº¥n vÃ o thÃ´ng bÃ¡o "Má»Ÿ trong Safari"
4. Xem thÃ´ng tin tháº» dá»‹ á»©ng

### 3. QuÃ©t Báº±ng Camera Android

1. Má»Ÿ app **Camera** hoáº·c **Google Lens**
2. HÆ°á»›ng camera vÃ o mÃ£ QR
3. Nháº¥n vÃ o link hiá»ƒn thá»‹
4. Xem thÃ´ng tin tháº» dá»‹ á»©ng

### 4. QuÃ©t Báº±ng App Ná»™i Bá»™

1. ÄÄƒng nháº­p há»‡ thá»‘ng
2. VÃ o **Tháº» Dá»‹ á»¨ng** â†’ **QuÃ©t QR**
3. QuÃ©t nhÆ° bÃ¬nh thÆ°á»ng
4. Váº«n hoáº¡t Ä‘á»™ng nhÆ° trÆ°á»›c

### 5. Import áº¢nh QR Tá»« MÃ¡y ğŸ†•

**TÃ­nh nÄƒng má»›i**: Báº¡n cÃ³ thá»ƒ táº£i lÃªn áº£nh QR cÃ³ sáºµn thay vÃ¬ quÃ©t trá»±c tiáº¿p!

#### TrÆ°á»ng Há»£p Sá»­ Dá»¥ng
- ğŸ“¸ ÄÃ£ chá»¥p áº£nh QR trÆ°á»›c Ä‘Ã³
- ğŸ’¾ CÃ³ file áº£nh QR Ä‘Æ°á»£c gá»­i qua email/Zalo
- ğŸ“± áº¢nh chá»¥p mÃ n hÃ¬nh QR code
- ğŸ–¼ï¸ áº¢nh QR Ä‘Æ°á»£c lÆ°u trong thÆ° viá»‡n áº£nh

#### CÃ¡ch Sá»­ Dá»¥ng

**TrÃªn Äiá»‡n Thoáº¡i:**
1. ÄÄƒng nháº­p há»‡ thá»‘ng
2. VÃ o **Tháº» Dá»‹ á»¨ng** â†’ **QuÃ©t QR**
3. Nháº¥n nÃºt **"Táº£i áº£nh QR lÃªn"** ğŸ–¼ï¸
4. Chá»n áº£nh QR tá»« thÆ° viá»‡n áº£nh
5. Há»‡ thá»‘ng tá»± Ä‘á»™ng Ä‘á»c vÃ  hiá»ƒn thá»‹ thÃ´ng tin

**TrÃªn MÃ¡y TÃ­nh:**
1. ÄÄƒng nháº­p há»‡ thá»‘ng
2. VÃ o **Tháº» Dá»‹ á»¨ng** â†’ **QuÃ©t QR**
3. Nháº¥n nÃºt **"Táº£i áº£nh QR lÃªn"** ğŸ–¼ï¸
4. Chá»n file áº£nh QR tá»« mÃ¡y tÃ­nh
5. Há»‡ thá»‘ng tá»± Ä‘á»™ng Ä‘á»c vÃ  hiá»ƒn thá»‹ thÃ´ng tin

#### Äá»‹nh Dáº¡ng áº¢nh Há»— Trá»£
- âœ… JPEG/JPG
- âœ… PNG
- âœ… WebP
- âœ… GIF
- âœ… BMP

#### LÆ°u Ã
- ğŸ“ áº¢nh QR nÃªn rÃµ nÃ©t, khÃ´ng bá»‹ má»
- ğŸ”† Äá»™ sÃ¡ng áº£nh phÃ¹ há»£p (khÃ´ng quÃ¡ tá»‘i/quÃ¡ sÃ¡ng)
- ğŸ“ QR code nÃªn chiáº¿m Ã­t nháº¥t 30% diá»‡n tÃ­ch áº£nh
- ğŸ¯ QR code khÃ´ng bá»‹ che khuáº¥t hoáº·c biáº¿n dáº¡ng

## ğŸ”’ Báº£o Máº­t

### ThÃ´ng Tin CÃ´ng Khai
âœ… KhÃ´ng cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ xem  
âœ… Chá»‰ hiá»ƒn thá»‹ thÃ´ng tin cáº§n thiáº¿t cho cáº¥p cá»©u  
âœ… KhÃ´ng lá»™ thÃ´ng tin nháº¡y cáº£m  

### Kiá»ƒm SoÃ¡t Truy Cáº­p
âœ… Chá»‰ tháº» **active** má»›i hiá»ƒn thá»‹  
âœ… Tháº» háº¿t háº¡n/vÃ´ hiá»‡u â†’ hiá»ƒn thá»‹ lá»—i  
âœ… Validate mÃ£ tháº» Ä‘Ãºng format  
âœ… API verify cÃ³ kiá»ƒm tra báº£o máº­t  

## ğŸ“‹ ThÃ´ng Tin Hiá»ƒn Thá»‹

Khi quÃ©t QR, ngÆ°á»i xem sáº½ tháº¥y:

### 1. ThÃ´ng Tin Bá»‡nh NhÃ¢n
- Há» tÃªn
- Tuá»•i
- Giá»›i tÃ­nh
- Bá»‡nh viá»‡n Ä‘iá»u trá»‹

### 2. ThÃ´ng Tin Dá»‹ á»¨ng
- Danh sÃ¡ch dá»‹ á»©ng
- Má»©c Ä‘á»™ nghiÃªm trá»ng
- Triá»‡u chá»©ng
- Má»©c Ä‘á»™ cháº¯c cháº¯n

### 3. Thuá»‘c Nghi Ngá» (Náº¿u cÃ³)
âš ï¸ **Cáº¢NH BÃO QUAN TRá»ŒNG**
- TÃªn thuá»‘c nghi ngá» gÃ¢y dá»‹ á»©ng
- TÃªn thÆ°Æ¡ng máº¡i
- Dáº¡ng bÃ o cháº¿
- Chá»‰ Ä‘á»‹nh
- Pháº£n á»©ng sau khi ngá»«ng thuá»‘c

### 4. LiÃªn Há»‡ Kháº©n Cáº¥p
- BÃ¡c sÄ© Ä‘iá»u trá»‹
- Sá»‘ Ä‘iá»‡n thoáº¡i (cÃ³ nÃºt gá»i trá»±c tiáº¿p)
- HÆ°á»›ng dáº«n xá»­ lÃ½ kháº©n cáº¥p

## ğŸ› ï¸ Cáº¥u HÃ¬nh Há»‡ Thá»‘ng

### File ÄÃ£ Cáº­p Nháº­t

1. **lib/qr-service.ts**
   - QR code giá» chá»©a URL thay vÃ¬ JSON
   - Format: `{baseUrl}/allergy-cards/view/{cardCode}`

2. **app/allergy-cards/view/[code]/page.tsx** (Má»šI)
   - Trang public view khÃ´ng cáº§n Ä‘Äƒng nháº­p
   - Hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ thÃ´ng tin tháº» dá»‹ á»©ng
   - Giao diá»‡n Ä‘áº¹p, responsive

3. **middleware.ts**
   - Cho phÃ©p public access vÃ o `/allergy-cards/view/*`
   - KhÃ´ng cáº§n authentication

4. **app/allergy-cards/scan/page.tsx** (Cáº¬P NHáº¬T Má»šI)
   - Há»— trá»£ quÃ©t cáº£ URL vÃ  JSON
   - TÆ°Æ¡ng thÃ­ch ngÆ°á»£c vá»›i QR cÅ©
   - **TÃNH NÄ‚NG Má»šI**: Import áº£nh QR tá»« mÃ¡y
   - Sá»­ dá»¥ng thÆ° viá»‡n `jsQR` Ä‘á»ƒ decode QR tá»« hÃ¬nh áº£nh
   - Há»— trá»£ má»i Ä‘á»‹nh dáº¡ng áº£nh phá»• biáº¿n

## ğŸ§ª Kiá»ƒm Tra TÃ­nh NÄƒng

### BÆ°á»›c 1: Táº¡o Tháº» Dá»‹ á»¨ng Má»›i
```bash
# Táº¡o tháº» qua giao diá»‡n hoáº·c API
# QR code sáº½ tá»± Ä‘á»™ng chá»©a URL
```

### BÆ°á»›c 2: Táº£i QR Code
```bash
# Táº£i hÃ¬nh QR tá»« tháº» vá»«a táº¡o
# Hoáº·c in trá»±c tiáº¿p tháº» dá»‹ á»©ng
```

### BÆ°á»›c 3: Test QuÃ©t
1. **Test Zalo**: Má»Ÿ Zalo â†’ QuÃ©t QR â†’ Kiá»ƒm tra hiá»ƒn thá»‹
2. **Test Camera**: Má»Ÿ Camera â†’ QuÃ©t QR â†’ Kiá»ƒm tra link
3. **Test App (Camera)**: ÄÄƒng nháº­p â†’ QuÃ©t QR báº±ng camera â†’ Váº«n hoáº¡t Ä‘á»™ng
4. **Test App (Upload)** ğŸ†•: ÄÄƒng nháº­p â†’ Táº£i áº£nh QR lÃªn â†’ Kiá»ƒm tra káº¿t quáº£

### BÆ°á»›c 4: Test Import áº¢nh ğŸ†•
1. LÆ°u áº£nh QR vÃ o mÃ¡y/Ä‘iá»‡n thoáº¡i
2. VÃ o trang QuÃ©t QR
3. Nháº¥n "Táº£i áº£nh QR lÃªn"
4. Chá»n file áº£nh Ä‘Ã£ lÆ°u
5. Kiá»ƒm tra hiá»ƒn thá»‹

### Káº¿t Quáº£ Mong Äá»£i
âœ… Má»Ÿ trÃ¬nh duyá»‡t web  
âœ… Hiá»ƒn thá»‹ trang thÃ´ng tin tháº»  
âœ… Äáº§y Ä‘á»§ thÃ´ng tin dá»‹ á»©ng  
âœ… CÃ³ nÃºt gá»i Ä‘iá»‡n kháº©n cáº¥p  
âœ… Cáº£nh bÃ¡o rÃµ rÃ ng náº¿u cÃ³ thuá»‘c nghi ngá»  
âœ… Upload áº£nh QR hoáº¡t Ä‘á»™ng mÆ°á»£t mÃ  ğŸ†•  

## ğŸŒ URL Format

### URL Pattern
```
https://yourdomain.com/allergy-cards/view/{CARD_CODE}

VÃ­ dá»¥:
https://yourdomain.com/allergy-cards/view/AC-2024-123456
```

### API Endpoint
```
GET /api/allergy-cards/verify/{CARD_CODE}

Response:
{
  "success": true,
  "data": {
    "cardCode": "AC-2024-123456",
    "patientName": "Nguyá»…n VÄƒn A",
    "allergies": [...],
    "suspectedDrugs": [...],
    ...
  }
}
```

## ğŸ¨ Giao Diá»‡n

### Desktop
- Layout responsive, rá»™ng rÃ£i
- Card info dá»… Ä‘á»c
- NÃºt gá»i Ä‘iá»‡n dá»… nháº¥n

### Mobile
- Tá»‘i Æ°u cho Ä‘iá»‡n thoáº¡i
- NÃºt gá»i trá»±c tiáº¿p báº±ng `tel:`
- Scroll mÆ°á»£t mÃ 

### MÃ u Sáº¯c
- ğŸ”µ **Xanh dÆ°Æ¡ng**: ThÃ´ng tin bá»‡nh nhÃ¢n
- ğŸŸ  **Cam**: ThÃ´ng tin dá»‹ á»©ng
- ğŸ”´ **Äá»**: Thuá»‘c nghi ngá» (cáº£nh bÃ¡o)
- ğŸŸ¢ **Xanh lÃ¡**: LiÃªn há»‡ kháº©n cáº¥p
- ğŸŸ¡ **VÃ ng**: HÆ°á»›ng dáº«n xá»­ lÃ½

## ğŸ“Š Lá»£i Ãch

### 1. Tiá»‡n Lá»£i
âœ… KhÃ´ng cáº§n cÃ i app chuyÃªn dá»¥ng  
âœ… QuÃ©t báº±ng báº¥t ká»³ thiáº¿t bá»‹ nÃ o  
âœ… Truy cáº­p nhanh thÃ´ng tin kháº©n cáº¥p  
âœ… **Import áº£nh QR khi khÃ´ng thá»ƒ quÃ©t trá»±c tiáº¿p** ğŸ†•  

### 2. An ToÃ n
âœ… ThÃ´ng tin luÃ´n cáº­p nháº­t tá»« database  
âœ… Validate tháº» cÃ²n hiá»‡u lá»±c  
âœ… Hiá»ƒn thá»‹ cáº£nh bÃ¡o rÃµ rÃ ng  

### 3. Phá»• Biáº¿n
âœ… Dá»… chia sáº» (copy link)  
âœ… Má»i ngÆ°á»i Ä‘á»u dÃ¹ng Ä‘Æ°á»£c  
âœ… TÆ°Æ¡ng thÃ­ch má»i ná»n táº£ng  

### 4. Linh Hoáº¡t ğŸ†•
âœ… QuÃ©t trá»±c tiáº¿p báº±ng camera  
âœ… Hoáº·c táº£i áº£nh QR Ä‘Ã£ chá»¥p sáºµn  
âœ… Sá»­ dá»¥ng áº£nh QR nháº­n qua email/chat  
âœ… LÃ m viá»‡c offline vá»›i áº£nh Ä‘Ã£ lÆ°u  

## ğŸ”§ Troubleshooting

### Váº¥n Äá» 1: KhÃ´ng Má»Ÿ ÄÆ°á»£c Link
**NguyÃªn nhÃ¢n**: MÃ£ tháº» khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ háº¿t háº¡n  
**Giáº£i phÃ¡p**: Kiá»ƒm tra status tháº» trong database

### Váº¥n Äá» 2: Hiá»ƒn thá»‹ "KhÃ´ng TÃ¬m Tháº¥y Tháº»"
**NguyÃªn nhÃ¢n**: Tháº» Ä‘Ã£ bá»‹ xÃ³a hoáº·c inactive  
**Giáº£i phÃ¡p**: Cáº­p nháº­t status = 'active'

### Váº¥n Äá» 3: QR CÅ© Váº«n Chá»©a JSON
**NguyÃªn nhÃ¢n**: QR Ä‘Æ°á»£c táº¡o trÆ°á»›c khi update  
**Giáº£i phÃ¡p**: 
1. VÃ o "Chá»‰nh sá»­a tháº»"
2. LÆ°u láº¡i â†’ QR tá»± Ä‘á»™ng update

### Váº¥n Äá» 4: Middleware Cháº·n Truy Cáº­p
**NguyÃªn nhÃ¢n**: Route khÃ´ng Ä‘Æ°á»£c config public  
**Giáº£i phÃ¡p**: Kiá»ƒm tra middleware.ts cÃ³ `/allergy-cards/view/` khÃ´ng

### Váº¥n Äá» 5: KhÃ´ng Äá»c ÄÆ°á»£c QR Tá»« áº¢nh ğŸ†•
**NguyÃªn nhÃ¢n**: áº¢nh QR khÃ´ng rÃµ nÃ©t hoáº·c bá»‹ má»  
**Giáº£i phÃ¡p**:
1. Chá»¥p láº¡i áº£nh QR vá»›i Ä‘á»™ phÃ¢n giáº£i cao hÆ¡n
2. Äáº£m báº£o Ã¡nh sÃ¡ng Ä‘á»§ khi chá»¥p
3. QR code khÃ´ng bá»‹ che khuáº¥t
4. Thá»­ zoom vÃ o QR trÆ°á»›c khi chá»¥p

### Váº¥n Äá» 6: File Upload KhÃ´ng Hoáº¡t Äá»™ng ğŸ†•
**NguyÃªn nhÃ¢n**: TrÃ¬nh duyá»‡t cháº·n file upload  
**Giáº£i phÃ¡p**:
1. Kiá»ƒm tra quyá»n file access cá»§a trÃ¬nh duyá»‡t
2. Thá»­ vá»›i trÃ¬nh duyá»‡t khÃ¡c (Chrome, Safari, Firefox)
3. Kiá»ƒm tra Ä‘á»‹nh dáº¡ng file (pháº£i lÃ  áº£nh)

### Váº¥n Äá» 7: "KhÃ´ng TÃ¬m Tháº¥y MÃ£ QR Trong HÃ¬nh áº¢nh" ğŸ†•
**NguyÃªn nhÃ¢n**: QR quÃ¡ nhá» hoáº·c khÃ´ng rÃµ trong áº£nh  
**Giáº£i phÃ¡p**:
1. Crop áº£nh Ä‘á»ƒ QR chiáº¿m nhiá»u diá»‡n tÃ­ch hÆ¡n
2. TÄƒng Ä‘á»™ sÃ¡ng/tÆ°Æ¡ng pháº£n cá»§a áº£nh
3. Chá»¥p láº¡i áº£nh vá»›i gÃ³c nhÃ¬n tháº³ng (khÃ´ng nghiÃªng)
4. Äáº£m báº£o QR khÃ´ng bá»‹ biáº¿n dáº¡ng

### Váº¥n Äá» 8: "Tháº» khÃ´ng tá»“n táº¡i trong há»‡ thá»‘ng" ğŸ”¥
**NguyÃªn nhÃ¢n**: Tháº» chÆ°a Ä‘Æ°á»£c táº¡o trong database hoáº·c Ä‘Ã£ bá»‹ xÃ³a  
**Giáº£i phÃ¡p**:
1. Kiá»ƒm tra tháº» cÃ³ trong database khÃ´ng (xem `DEBUG-QR-SCAN.md`)
2. Táº¡o tháº» dá»‹ á»©ng má»›i qua giao diá»‡n
3. Cháº¡y SQL: `SELECT * FROM allergy_cards WHERE card_code = 'AC-YYYY-XXXXXX'`
4. Äáº£m báº£o tháº» cÃ³ status = 'active'
5. Xem hÆ°á»›ng dáº«n chi tiáº¿t táº¡i: `DEBUG-QR-SCAN.md`

## ğŸ“ Best Practices

### 1. Khi Táº¡o Tháº» Má»›i
- âœ… LuÃ´n link vá»›i ADR report náº¿u cÃ³
- âœ… Nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin liÃªn há»‡
- âœ… Kiá»ƒm tra sá»‘ Ä‘iá»‡n thoáº¡i bÃ¡c sÄ©

### 2. Khi In Tháº»
- âœ… In QR Ä‘á»§ lá»›n (tá»‘i thiá»ƒu 3x3 cm)
- âœ… Äáº£m báº£o QR khÃ´ng bá»‹ má»/nhÃ²e
- âœ… Test quÃ©t trÆ°á»›c khi phÃ¡t hÃ nh

### 3. Khi Chia Sáº»
- âœ… Copy link tá»« QR Ä‘á»ƒ gá»­i qua Zalo/SMS
- âœ… CÃ³ thá»ƒ chia sáº» cho nhiá»u ngÆ°á»i
- âœ… Link vÄ©nh viá»…n (trá»« khi xÃ³a tháº»)

## ğŸš€ TÆ°Æ¡ng Lai

### CÃ³ Thá»ƒ Má»Ÿ Rá»™ng
- [x] **Import áº£nh QR tá»« mÃ¡y** âœ… (ÄÃ£ hoÃ n thÃ nh)
- [ ] ThÃªm Ä‘a ngÃ´n ngá»¯ (EN, VN)
- [ ] Export PDF trá»±c tiáº¿p tá»« view
- [ ] QR code Ä‘á»™ng theo ngÃ´n ngá»¯
- [ ] Analytics: theo dÃµi lÆ°á»£t quÃ©t
- [ ] Notification khi tháº» Ä‘Æ°á»£c quÃ©t
- [ ] Batch scanning: quÃ©t nhiá»u QR cÃ¹ng lÃºc
- [ ] QR enhancement: tá»± Ä‘á»™ng cáº£i thiá»‡n cháº¥t lÆ°á»£ng áº£nh QR

## ğŸ“ Há»— Trá»£

Náº¿u cÃ³ váº¥n Ä‘á»:
1. Kiá»ƒm tra tháº» status = 'active'
2. Kiá»ƒm tra middleware config
3. Xem API logs táº¡i `/api/allergy-cards/verify/[code]`
4. Test trÃªn nhiá»u thiáº¿t bá»‹

---

## ğŸ“¦ ThÆ° Viá»‡n Sá»­ Dá»¥ng

- **@yudiel/react-qr-scanner**: QuÃ©t QR báº±ng camera
- **jsQR** ğŸ†•: Decode QR tá»« hÃ¬nh áº£nh
- **Next.js**: Framework React
- **TailwindCSS**: Styling

---

**Cáº­p nháº­t má»›i nháº¥t**: 
- âœ… TÃ­nh nÄƒng import áº£nh QR Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o (30/09/2025)
- âœ… Há»— trá»£ quÃ©t QR báº±ng Zalo/Camera/App
- âœ… Táº£i lÃªn áº£nh QR tá»« mÃ¡y

**Tháº» cÅ©**: Cáº§n chá»‰nh sá»­a vÃ  lÆ°u láº¡i Ä‘á»ƒ cáº­p nháº­t QR code.

ğŸ‰ **Giá» Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ:**
- QuÃ©t QR tháº» dá»‹ á»©ng báº±ng Zalo
- QuÃ©t báº±ng camera Ä‘iá»‡n thoáº¡i
- **Táº£i áº£nh QR lÃªn tá»« mÃ¡y** ğŸ†•
