-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.adr_information (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  summary text,
  content text NOT NULL,
  type USER-DEFINED DEFAULT 'news'::information_type,
  priority integer DEFAULT 1 CHECK (priority >= 1 AND priority <= 5),
  tags ARRAY,
  featured_image_url text,
  attachments jsonb,
  status USER-DEFINED DEFAULT 'draft'::information_status,
  published_at timestamp with time zone,
  expires_at timestamp with time zone,
  created_by_user_id uuid NOT NULL,
  author_name character varying NOT NULL,
  author_organization character varying,
  target_audience ARRAY,
  is_pinned boolean DEFAULT false,
  show_on_homepage boolean DEFAULT false,
  view_count integer DEFAULT 0,
  likes_count integer DEFAULT 0,
  meta_keywords character varying,
  meta_description character varying,
  slug character varying UNIQUE,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT adr_information_pkey PRIMARY KEY (id),
  CONSTRAINT adr_information_created_by_user_id_fkey FOREIGN KEY (created_by_user_id) REFERENCES public.users(id)
);
CREATE TABLE public.adr_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  report_code character varying NOT NULL UNIQUE,
  reporter_id uuid,
  organization character varying NOT NULL,
  patient_name character varying NOT NULL,
  patient_birth_date date NOT NULL,
  patient_age integer NOT NULL CHECK (patient_age >= 0 AND patient_age <= 150),
  patient_gender USER-DEFINED NOT NULL,
  patient_weight numeric CHECK (patient_weight > 0::numeric AND patient_weight <= 500::numeric),
  adr_occurrence_date date NOT NULL,
  adr_description text NOT NULL,
  related_tests text,
  medical_history text,
  treatment_response text,
  severity_level USER-DEFINED NOT NULL,
  outcome_after_treatment USER-DEFINED NOT NULL,
  causality_assessment USER-DEFINED NOT NULL,
  assessment_scale USER-DEFINED NOT NULL,
  medical_staff_comment text,
  reporter_name character varying NOT NULL,
  reporter_profession character varying NOT NULL,
  reporter_phone character varying,
  reporter_email character varying,
  report_type USER-DEFINED NOT NULL,
  report_date date NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  reaction_onset_time text,
  CONSTRAINT adr_reports_pkey PRIMARY KEY (id),
  CONSTRAINT adr_reports_reporter_id_fkey FOREIGN KEY (reporter_id) REFERENCES public.users(id)
);
CREATE TABLE public.allergy_cards (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  card_code character varying NOT NULL UNIQUE,
  report_id uuid,
  patient_name character varying NOT NULL,
  patient_gender character varying CHECK (patient_gender::text = ANY (ARRAY['male'::character varying, 'female'::character varying, 'other'::character varying]::text[])),
  patient_age integer,
  patient_id_number character varying,
  hospital_name character varying NOT NULL,
  department character varying,
  doctor_name character varying NOT NULL,
  doctor_phone character varying,
  issued_date date NOT NULL DEFAULT CURRENT_DATE,
  issued_by_user_id uuid NOT NULL,
  organization character varying NOT NULL,
  qr_code_data text NOT NULL,
  qr_code_url text,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'expired'::character varying]::text[])),
  expiry_date date,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT allergy_cards_pkey PRIMARY KEY (id),
  CONSTRAINT allergy_cards_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.adr_reports(id),
  CONSTRAINT allergy_cards_issued_by_user_id_fkey FOREIGN KEY (issued_by_user_id) REFERENCES public.users(id)
);
CREATE TABLE public.card_allergies (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  card_id uuid NOT NULL,
  allergen_name character varying NOT NULL,
  certainty_level character varying NOT NULL CHECK (certainty_level::text = ANY (ARRAY['suspected'::character varying, 'confirmed'::character varying]::text[])),
  clinical_manifestation text,
  severity_level character varying CHECK (severity_level::text = ANY (ARRAY['mild'::character varying, 'moderate'::character varying, 'severe'::character varying, 'life_threatening'::character varying]::text[])),
  reaction_type character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT card_allergies_pkey PRIMARY KEY (id),
  CONSTRAINT card_allergies_card_id_fkey FOREIGN KEY (card_id) REFERENCES public.allergy_cards(id)
);
CREATE TABLE public.concurrent_drugs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  report_id uuid NOT NULL,
  drug_name text NOT NULL,
  dosage_form_strength text,
  start_date date,
  end_date date,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT concurrent_drugs_pkey PRIMARY KEY (id),
  CONSTRAINT concurrent_drugs_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.adr_reports(id)
);
CREATE TABLE public.information_likes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  information_id uuid NOT NULL,
  user_id uuid NOT NULL,
  liked_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT information_likes_pkey PRIMARY KEY (id),
  CONSTRAINT information_likes_information_id_fkey FOREIGN KEY (information_id) REFERENCES public.adr_information(id),
  CONSTRAINT information_likes_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.information_views (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  information_id uuid NOT NULL,
  user_id uuid,
  user_ip character varying,
  viewed_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  read_duration_seconds integer DEFAULT 0,
  CONSTRAINT information_views_pkey PRIMARY KEY (id),
  CONSTRAINT information_views_information_id_fkey FOREIGN KEY (information_id) REFERENCES public.adr_information(id),
  CONSTRAINT information_views_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  recipient_id uuid NOT NULL,
  sender_id uuid,
  type USER-DEFINED NOT NULL DEFAULT 'new_report'::notification_type,
  title text NOT NULL,
  message text NOT NULL,
  data jsonb,
  read boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_recipient_id_fkey FOREIGN KEY (recipient_id) REFERENCES public.users(id),
  CONSTRAINT notifications_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES public.users(id)
);
CREATE TABLE public.quiz_achievements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  achievement_key character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text NOT NULL,
  achievement_type USER-DEFINED NOT NULL,
  criteria jsonb NOT NULL,
  points_reward integer DEFAULT 0,
  badge_icon character varying,
  badge_color character varying,
  is_active boolean DEFAULT true,
  rarity character varying DEFAULT 'common'::character varying,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_achievements_pkey PRIMARY KEY (id)
);
CREATE TABLE public.quiz_answers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id uuid,
  question_id uuid,
  selected_answer character varying,
  is_correct boolean,
  points_earned integer DEFAULT 0,
  time_taken_seconds integer,
  was_skipped boolean DEFAULT false,
  hint_used boolean DEFAULT false,
  explanation_viewed boolean DEFAULT false,
  answered_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_answers_pkey PRIMARY KEY (id),
  CONSTRAINT quiz_answers_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.quiz_sessions(id),
  CONSTRAINT quiz_answers_question_id_fkey FOREIGN KEY (question_id) REFERENCES public.quiz_questions(id)
);
CREATE TABLE public.quiz_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  category_key USER-DEFINED,
  description text,
  icon_name character varying,
  color_scheme character varying,
  total_questions integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.quiz_daily_challenges (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  challenge_date date NOT NULL UNIQUE,
  title character varying NOT NULL,
  description text,
  category_id uuid,
  difficulty USER-DEFINED NOT NULL,
  question_count integer DEFAULT 10,
  time_limit_seconds integer,
  base_points integer DEFAULT 100,
  bonus_multiplier numeric DEFAULT 1.0,
  selected_questions ARRAY NOT NULL,
  participants_count integer DEFAULT 0,
  completions_count integer DEFAULT 0,
  average_score numeric DEFAULT 0.00,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_daily_challenges_pkey PRIMARY KEY (id),
  CONSTRAINT quiz_daily_challenges_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.quiz_categories(id)
);
CREATE TABLE public.quiz_leaderboards (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  leaderboard_type character varying NOT NULL,
  category_id uuid,
  time_period character varying,
  total_score integer NOT NULL,
  questions_answered integer NOT NULL,
  accuracy_percentage numeric NOT NULL,
  average_time numeric,
  rank_position integer NOT NULL,
  rank_change integer DEFAULT 0,
  calculated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_leaderboards_pkey PRIMARY KEY (id),
  CONSTRAINT quiz_leaderboards_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT quiz_leaderboards_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.quiz_categories(id)
);
CREATE TABLE public.quiz_questions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  category_id uuid,
  question_text text NOT NULL,
  question_type USER-DEFINED DEFAULT 'multiple_choice'::quiz_question_type,
  difficulty USER-DEFINED DEFAULT 'beginner'::quiz_difficulty,
  options jsonb NOT NULL,
  correct_answer character varying NOT NULL,
  explanation text,
  reference_source text,
  learning_points ARRAY,
  estimated_time_seconds integer DEFAULT 60,
  points_value integer DEFAULT 10,
  times_answered integer DEFAULT 0,
  times_correct integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_by uuid,
  reviewed_by uuid,
  review_status character varying DEFAULT 'pending'::character varying,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_questions_pkey PRIMARY KEY (id),
  CONSTRAINT quiz_questions_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.quiz_categories(id),
  CONSTRAINT quiz_questions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT quiz_questions_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(id)
);
CREATE TABLE public.quiz_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  category_id uuid,
  session_name character varying,
  difficulty_level USER-DEFINED,
  total_questions integer NOT NULL,
  time_limit_seconds integer,
  questions_answered integer DEFAULT 0,
  correct_answers integer DEFAULT 0,
  total_score integer DEFAULT 0,
  time_taken_seconds integer,
  completion_percentage numeric DEFAULT 0.00,
  status character varying DEFAULT 'in_progress'::character varying,
  started_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT quiz_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT quiz_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT quiz_sessions_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.quiz_categories(id)
);
CREATE TABLE public.suspected_drugs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  report_id uuid,
  drug_name character varying NOT NULL,
  commercial_name character varying,
  dosage_form character varying,
  manufacturer character varying,
  batch_number character varying,
  dosage_and_frequency text,
  route_of_administration character varying,
  start_date date,
  end_date date,
  indication text,
  reaction_improved_after_stopping USER-DEFINED NOT NULL,
  reaction_reoccurred_after_rechallenge USER-DEFINED NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT suspected_drugs_pkey PRIMARY KEY (id),
  CONSTRAINT suspected_drugs_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.adr_reports(id)
);
CREATE TABLE public.user_achievements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  achievement_id uuid,
  earned_from_session uuid,
  points_earned integer DEFAULT 0,
  progress jsonb,
  is_notified boolean DEFAULT false,
  earned_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT user_achievements_pkey PRIMARY KEY (id),
  CONSTRAINT user_achievements_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT user_achievements_achievement_id_fkey FOREIGN KEY (achievement_id) REFERENCES public.quiz_achievements(id),
  CONSTRAINT user_achievements_earned_from_session_fkey FOREIGN KEY (earned_from_session) REFERENCES public.quiz_sessions(id)
);
CREATE TABLE public.user_challenge_participation (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  challenge_id uuid,
  session_id uuid,
  score integer NOT NULL,
  completion_time_seconds integer,
  rank_in_challenge integer,
  bonus_points integer DEFAULT 0,
  completed_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT user_challenge_participation_pkey PRIMARY KEY (id),
  CONSTRAINT user_challenge_participation_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT user_challenge_participation_challenge_id_fkey FOREIGN KEY (challenge_id) REFERENCES public.quiz_daily_challenges(id),
  CONSTRAINT user_challenge_participation_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.quiz_sessions(id)
);
CREATE TABLE public.user_quiz_stats (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid UNIQUE,
  total_sessions integer DEFAULT 0,
  total_questions_answered integer DEFAULT 0,
  total_correct_answers integer DEFAULT 0,
  total_points_earned integer DEFAULT 0,
  average_score numeric DEFAULT 0.00,
  category_stats jsonb DEFAULT '{}'::jsonb,
  current_streak integer DEFAULT 0,
  longest_streak integer DEFAULT 0,
  last_activity_date date,
  total_time_spent_seconds integer DEFAULT 0,
  average_time_per_question numeric DEFAULT 0.00,
  current_rank integer,
  best_rank integer,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT user_quiz_stats_pkey PRIMARY KEY (id),
  CONSTRAINT user_quiz_stats_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  role USER-DEFINED DEFAULT 'user'::user_role,
  organization character varying,
  phone character varying,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  password_hash character varying,
  reset_token character varying,
  reset_token_expires timestamp with time zone,
  password_updated_at timestamp with time zone,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);